stages:
- deploy
- test

deploy_minio:
  stage: deploy
  image:
    name: bitnami/kubectl:latest
    entrypoint: ['']
  script:
    - echo "deploy_minio"
    - kubectl --insecure-skip-tls-verify=true apply -f applications/minio/namespace.yaml
    - kubectl --insecure-skip-tls-verify=true create secret generic minio-credentials --from-literal=MINIO_ROOT_USER=$MINIO_ROOT_USER --from-literal=MINIO_ROOT_PASSWORD=$MINIO_ROOT_PASSWORD # define in Gitlab ENV
    - kubectl --insecure-skip-tls-verify=true apply -f applications/minio/deployment.yaml
    - kubectl --insecure-skip-tls-verify=true apply -f applications/minio/service.yaml
    
deploy_crawlab:
  stage: deploy
  script:
    - echo "deploy_crawlab"

deploy_torproxy:
  stage: deploy
  script:
    - echo "deploy_torproxy"
    
deploy_kafka:
  stage: deploy
  needs:
    - deploy_crawlab
  script:
    - echo "deploy_kafka"
    
deploy_oniondownloader:
  stage: deploy
  needs:
    - deploy_torproxy
    - deploy_minio
    - deploy_kafka
  script:
    - echo "deploy_oniondownloader"
    

